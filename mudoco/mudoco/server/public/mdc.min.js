var _mdcq=_mdcq||[];MuDoCo=function(){this.options={localCookieName:"MDCL"};this.xssPending=[];this.data={}};MuDoCo.singleton=null;MuDoCo.me=function(){if(this.singleton==null){this.singleton=new MuDoCo}return this.singleton};MuDoCo.prototype.callbacks={};MuDoCo.prototype.callbacks.fallback=function(e,t,n,r){if(e=="run"){this.mdcXssAjax({vars:t,success:n,error:r})}};MuDoCo.prototype.callbacks.session=function(e,t,n,r){this.callbacks.fallback.call(this,e,t,n,r);if(e=="success"){for(var i in t.data){this.data[i]=t.data[i]}}};MuDoCo.prototype.getMNonce=function(){return this.getCookie(this.options["localCookieName"])};MuDoCo.prototype.getCookie=function(e){var t;return(t=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?t[1]:null};MuDoCo.prototype.run=function(e,t,n,r){var i=this;if(this.getMNonce()){e.call(this,"run",t,n,function(){i.localBeacon({success:function(){e.call(i,"run",t,n,r)}})})}else{this.localBeacon({success:function(){e.call(i,"run",t,n,r)}})}};MuDoCo.prototype.processQ=function(){var e=this;if(_mdcq.length){var t=_mdcq.shift();if(typeof t=="function"){this.run(t,{},function(){e.processQ()})}else if(t.init){this.options[t.init]=t.value;this.processQ()}else if(t.plugin){this.callbacks[t.plugin]=t.value;this.processQ()}else if(t.query){this.query(t.query,t.vars,function(){e.processQ()})}else{this.processQ()}}};MuDoCo.prototype.query=function(e,t,n,r){var t=t||{};t.q=e;if(this.callbacks[e]==undefined){e="fallback"}this.run(this.callbacks[e],t,n,r)};MuDoCo.prototype.beacon=function(e){e=e||{};e.url=e.url||null;e.vars=e.vars||{};e.error=e.error||function(){};e.success=e.success||function(){};e.vars.r=Math.random();var t=[];for(var n in e.vars){t.push(n+"="+e.vars[n])}var r=t.join("&");if(e.url){var i=new Image;if(e.error){i.onerror=e.error}if(e.success){i.onload=e.success}i.src=e.url+"?"+r}};MuDoCo.prototype.localBeacon=function(e){e=e||{};e.url=e.url||this.options["localBeacon"];this.beacon(e)};MuDoCo.prototype.xssAjax=function(e){e=e||{};e.url=e.url||null;e.vars=e.vars||{};e.error=e.error||function(){};e.success=e.success||function(){};e.retry=e.retry||3;var t=this.nextPendingIndex();e.vars.i=t;e.vars.r=Math.random();e.id=e.id||"MuDoCo-xssAjax-"+t;var n=[];for(var r in e.vars){n.push(r+"="+e.vars[r])}var i=n.join("&");if(e.url){this.xssPending[t]={success:e.success,error:e.error,vars:e.vars};if(e.retry>0){e.retry--;var s=this;this.xssPending[t].timeout=window.setTimeout(function(){s.xssAjax(e)},1e4)}var o=document.createElement("script");o.setAttribute("type","text/javascript");o.setAttribute("src",e.url+"?"+i);o.setAttribute("id",e.id);var u;if(u=document.getElementById(e.id)){document.getElementsByTagName("head")[0].removeChild(u)}document.getElementsByTagName("head")[0].appendChild(o)}};MuDoCo.prototype.mdcXssAjax=function(e){e=e||{};e.vars=e.vars||{};e.vars["a"]=this.getMNonce();e.url=e.url||this.options["serverBase"]+"/public/xss.php";this.xssAjax(e)};MuDoCo.prototype.xssAjaxCallback=function(e){if(e.i!=null&&this.xssPending[e.i]){var t=this.xssPending[e.i];this.xssPending[e.i]=null;if(t.timeout)window.clearTimeout(t.timeout);var n=t.vars.q;var r=e.code==0?"success":"error";if(n&&this.callbacks[n]!=undefined){this.callbacks[n].call(this,r,e)}else if(n){this.callbacks.fallback.call(this,r,e)}if(e.code>=0){t.success(e)}else{t.error()}}};MuDoCo.prototype.nextPendingIndex=function(){var e=0;for(var t in this.xssPending){e=t;if(!this.xssPending[t])return parseInt(t)}return parseInt(e)+1};MuDoCo.me().processQ()